contentType: application/json
bigipHideTemplate: true
definitions:
  enable_pool:
    type: boolean
    default: true
  make_pool:
    type: boolean
    default: true
  enable_monitor:
    title: Pool Monitor
    description: Determine the availability and performance of devices, links, and services
      on a network.
    type: boolean
    default: true
  make_monitor:
    title: Automatically manage the pool monitor.
    type: boolean
    default: true
  monitor_name:
    title: Specify the name of an existing BIG-IP monitor.
    description: Monitors are used to determine the health of the application on each
      server. If an application instance does not respond or responds incorrectly, the
      system will cease to send client requests to that web server. The system will
      continue to monitor the instance and will begin sending requests once the application
      responds correctly.
    type: string
    enumFromBigip: ltm/monitor/smtp
    default: /Common/smtp
  monitor_interval:
    title: Specify the interval between monitor polls (in seconds).
    type: integer
    default: 30
  monitor_domain:
    title: Specify the domain name for which the SMTP server will accept mail.
    type: string
    default: ''
  monitor_username:
    title: Specify the user account to use for health checks.
    type: string
    default: ''
  monitor_passphrase:
    title: Specify the password to use with the user account for health checks.
    type: string
    format: password
    contentEncoding: base64
    default: ''
template: |
  {
    "{{tenant_name}}": {
      "{{app_name}}": {
        {{#enable_pool}}
          {{#make_pool}}
            {{#enable_monitor}}
              {{#make_monitor}}
                "{{app_name}}_monitor": {
                  "class": "Monitor",
                  "monitorType": "smtp",
                  "interval": {{monitor_interval}},
                  "timeout": 181,
                  "domain": "{{monitor_domain}}",
                  "username": "{{monitor_username}}",
                  "passphrase": {
                    "ciphertext": "{{monitor_passphrase}}",
                    "protected": "eyJhbGciOiJkaXIiLCJlbmMiOiJub25lIn0"
                  }
                },
                "{{app_name}}_pool": {
                  "monitors": [{
                    "use": "{{app_name}}_monitor"
                  }]
                }
              {{/make_monitor}}
              {{^make_monitor}}
                "{{app_name}}_pool": {
                  "monitors": [{
                    "bigip": "{{monitor_name}}"
                  }]
                }
              {{/make_monitor}}
            {{/enable_monitor}}
          {{/make_pool}}
        {{/enable_pool}}
      }
    }
  }