contentType: application/json
bigipHideTemplate: true
definitions:
  enable_pool:
    type: boolean
    default: true
  make_pool:
    type: boolean
    default: true
  enable_monitor:
    title: Pool Monitor
    description: Determine the availability and performance of devices, links, and services.
      on a network.
    type: boolean
    default: true
  make_monitor:
    title: FAST-Generated Pool Monitor
    description: Uncheck to use an existing BIG-IP Pool Monitor.
    type: boolean
    default: true
  monitor_name:
    title: Monitor
    description: Select an existing BIG-IP HTTP pool monitor. Monitors are used to determine the health of the application on each
      server. If an application instance does not respond or responds incorrectly, the
      system will cease to send client requests to that web server. The system will
      continue to monitor the instance and will begin sending requests once the application responds correctly.
    type: string
    enumFromBigip: ltm/monitor/ldap
    default: /Common/ldap
  monitor_interval:
    title: Monitor Polls
    description: Interval between monitor polls, in seconds.
    type: integer
    default: 30
  monitor_username:
    title: Health Check User Account
    description: A list of user accounts can be found on the BIG-IP under **System > Users**.
    type: string
    default: ''
  monitor_passphrase:
    title: Health Check Account Password
    type: string
    format: password
    contentEncoding: base64
    default: ''
  monitor_base:
    title: Health Monitor Directory Level
    description: Directory level for the health monitor to search.
    type: string
    default: ''
  monitor_filter:
    title: Health Check Search Query
    description: Search query to be used in the health check.
    type: string
    default: ''
template: |
  {
    "{{tenant_name}}": {
      "{{app_name}}": {
        {{#enable_pool}}
          {{#make_pool}}
            {{#enable_monitor}}
              {{#make_monitor}}
                "{{app_name}}_monitor": {
                  "class": "Monitor",
                  "monitorType": "ldap",
                  "interval": {{monitor_interval}},
                  "timeout": 181,
                  "username": "{{monitor_username}}",
                  "passphrase": {
                    "ciphertext": "{{monitor_passphrase}}",
                    "protected": "eyJhbGciOiJkaXIiLCJlbmMiOiJub25lIn0"
                  },
                  "base": "{{monitor_base}}",
                  "filter": "{{monitor_filter}}"
                },
                "{{app_name}}_pool": {
                  "monitors": [{
                    "use": "{{app_name}}_monitor"
                  }]
                }
              {{/make_monitor}}
              {{^make_monitor}}
                "{{app_name}}_pool": {
                  "monitors": [{
                    "bigip": "{{monitor_name}}"
                  }]
                }
              {{/make_monitor}}
            {{/enable_monitor}}
          {{/make_pool}}
        {{/enable_pool}}
      }
    }
  }