contentType: application/json
title: DNS Application Template
description: Configure high availability and optimization for DNS implementations.
allOf:
  - $ref: "_as3.yaml#"
  - contentType: application/json
    title: DNS Virtuals
    definitions:
      use_ipam:
        title: Use IPAM Provider
        description: Use an IP Address Management service to get an IP address
        type: boolean
        default: false
      virtual_address:
        title: Virtual Server IP Address
        description: This IP address, combined with the port you specify below, becomes
          the BIG-IP virtual server address and port, which clients use to access the application.
          The system uses this IP:Port for distributing requests to the web servers.
      virtual_address_ipam:
        title: Virtual Server IP Address from IPAM
        description: Select an IPAM Provider to get an IP address from.
          This IP address, combined with the port you specify below, becomes
          the BIG-IP virtual server address and port, which clients use to access the application.
          The system uses this IP:Port for distributing requests to the web servers.
        ipFromIpam: true
        default: ''
      virtual_port:
        title: Virtual Server Port
        default: 53
    template: |
      {
        "{{tenant_name}}": {
          "{{app_name}}": {
            "{{app_name}}_tcp": {
              {{#use_ipam}}
                "virtualAddresses": ["{{virtual_address_ipam}}"],
              {{/use_ipam}}
              {{^use_ipam}}
                "virtualAddresses": ["{{virtual_address:f5:ipv4_ipv6}}"],
              {{/use_ipam}}
              "virtualPort": {{virtual_port:f5:port}}
            },
            "{{app_name}}_udp": {
              {{#use_ipam}}
                "virtualAddresses": ["{{virtual_address_ipam}}"],
              {{/use_ipam}}
              {{^use_ipam}}
                "virtualAddresses": ["{{virtual_address:f5:ipv4_ipv6}}"],
              {{/use_ipam}}
              "virtualPort": {{virtual_port:f5:port}}
            }
          }
        }
      }
  - $ref: "_snat.yaml#/dns"
  - $ref: "_pool.yaml#/dns"
  - $ref: "_monitors.yaml#/dns"
  - $ref: "_irule.yaml#/dns"
anyOf:
  - {}
  - $ref: "_analytics.yaml#/dns"
  - contentType: application/json
    title: DNS Firewall
    bigipDependencies:
      - afm
    definitions:
      enable_firewall:
        title: Firewall
        type: boolean
        default: false
      firewall_allow_list:
        title: Allowed Networks
        description: Enter the source IP addresses allowed to access this application. To specify a network, use CIDR notation (e.g. 192.168.1.0/24)
        type: array
        uniqueItems: true
        items:
          type: string
        default: []
      log_profile_names:
        title: Security Log Profiles
        description: Hold the *control* key to select multiple log profiles.
        type: array
        uniqueItems: true
        items:
          type: string
          enumFromBigip: security/log/profile
        default: []
    template: |
      {
        "{{tenant_name}}": {
          "{{app_name}}": {
            {{#enable_firewall}}
              "{{app_name}}_fw_allow_list": {
                "class": "Firewall_Address_List",
                "addresses": {{firewall_allow_list}}
              },
              "default_fw_deny_list": {
                "class": "Firewall_Address_List",
                "addresses": ["0.0.0.0/0"]
              },
              "{{app_name}}_fw_rules": {
                "class": "Firewall_Rule_List",
                "rules": [
                  {
                    "protocol": "udp",
                    "name": "acceptUdpPackets",
                    "loggingEnabled": true,
                    "source": {
                      "addressLists": [
                        {
                          "use": "{{app_name}}_fw_allow_list"
                        }
                      ]
                    },
                    "action": "accept"
                  },
                  {
                    "protocol": "tcp",
                    "name": "acceptTcpPackets",
                    "loggingEnabled": true,
                    "source": {
                      "addressLists": [
                        {
                          "use": "{{app_name}}_fw_allow_list"
                        }
                      ]
                    },
                    "action": "accept"
                  },
                  {
                    "protocol": "any",
                    "name": "dropPackets",
                    "loggingEnabled": true,
                    "source": {
                      "addressLists": [
                        {
                          "use": "default_fw_deny_list"
                        }
                      ]
                    },
                    "action": "drop"
                  }
                ]
              },
              "{{app_name}}_fw_policy": {
                "class": "Firewall_Policy",
                "rules": [
                    {
                        "use": "{{app_name}}_fw_rules"
                    }
                ]
              },
              "{{app_name}}_tcp": {
                "policyFirewallEnforced": {
                  "use": "{{app_name}}_fw_policy"
                },
                "securityLogProfiles": [
                  {{#log_profile_names}}
                    { "bigip": {{ . }} },
                  {{/log_profile_names}}
                ]
              },
              "{{app_name}}_udp": {
                "policyFirewallEnforced": {
                  "use": "{{app_name}}_fw_policy"
                },
                "securityLogProfiles": [
                  {{#log_profile_names}}
                    { "bigip": {{ . }} },
                  {{/log_profile_names}}
                ]
              }
            {{/enable_firewall}}
          }
        }
      }
  - title: Telemetry
    contentType: application/json
    bigipHideTemplate: true
    bigipDependencies:
      - ts
    definitions:
      enable_telemetry:
        title: Forward logs to Telemetry Streaming
        type: boolean
        default: false
    anyOf:
      - {}
      - title: ASM Logging
        contentType: application/json
        bigipDependencies:
          - asm
        definitions:
            enable_telemetry:
                type: boolean
        template: |
          {
            "{{tenant_name}}": {
              "{{app_name}}": {
                {{#enable_telemetry}}
                "{{app_name}}_tcp": {
                  "securityLogProfiles": [
                    { "use": "telemetry_asm_security_log_profile" },
                  ]
                },
                "{{app_name}}_udp": {
                  "securityLogProfiles": [
                    { "use": "telemetry_asm_security_log_profile" },
                  ]
                }
                {{/enable_telemetry}}
              }
            }
          }
      - title: AFM Logging
        contentType: application/json
        bigipDependencies:
          - afm
          - asm
        definitions:
            enable_telemetry:
                type: boolean
        template: |
          {
            "{{tenant_name}}": {
              "{{app_name}}": {
                {{#enable_telemetry}}
                "{{app_name}}_tcp": {
                  "securityLogProfiles": [
                    { "use": "telemetry_afm_security_log_profile" },
                  ]
                },
                "{{app_name}}_udp": {
                  "securityLogProfiles": [
                    { "use": "telemetry_afm_security_log_profile" },
                  ]
                }
                {{/enable_telemetry}}
              }
            }
          }
    template: |
      {
        "{{tenant_name}}": {
          "{{app_name}}": {
            {{#enable_telemetry}}
            "{{app_name}}_tcp": {
              "profileTrafficLog": {
                "use": "telemetry_traffic_log_profile"
              }
            },
            "{{app_name}}_udp": {
              "profileTrafficLog": {
                "use": "telemetry_traffic_log_profile"
              }
            }
            {{/enable_telemetry}}
          }
        }
      }
template: |
  {
    "{{tenant_name}}": {
      "{{app_name}}": {
        "{{app_name}}_tcp": {
          "class": "Service_TCP",
          "profileTCP": {
            "ingress": "wan",
            "egress": "lan"
          }
        },
        "{{app_name}}_udp": {
          "class": "Service_UDP",
          "profileUDP": {
            "bigip": "/Common/udp_gtm_dns"
          },
          "profileDNS": {
            "bigip": "/Common/dns"
          }
        }
      }
    }
  }
