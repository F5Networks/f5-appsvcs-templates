definitions:
  tenant_name:
    title: 'What is the tenant name?'
    description: 'The tenant is the high-level grouping in an AS3 declaration. AS3 deploys all configuration for a given tenant in a BIG-IP partition of the same name.'
  app_name:
    title: 'What is the application name?'
    description: 'The application is the low-level grouping in an AS3 declaration. AS3 deploys all configuration for a given application in a BIG-IP folder within the tenant partition.'
  virtual_address:
    title: 'What IP address do you want to use for the virtual server?'
    description: 'This IP address, combined with the port you specify below, becomes the BIG-IP virtual server address and port, which clients use to access the application. The system intercepts requests to this IP:Port and distributes them to the web servers.'
  virtual_port:
    title: 'What TCP port do you want to use for the virtual server?'
  redirect:
    title: 'Redirect port 80 traffic to this virtual server'
  existing_pool:
    title: 'Use an existing pool'
    description: 'A load balancing pool is a logical set of devices, such as web servers, grouped together to receive and process traffic. When clients attempt to access the application via the BIG-IP virtual server, the BIG-IP system distributes requests to any of the servers that are members of that pool.'
  pool_name:
    title: 'Specify the name of an existing BIG-IP pool.'
  pool_port:
    title: 'What TCP port do you want to use for the pool members?'
  load_balancing_mode:
    title: 'Which load balancing method do you want to use?'
    description: 'A load balancing method is an algorithm that the BIG-IP system uses to select a pool member for processing a request. F5 recommends the Least Connections load balancing method, where new connections are routed to the node that has the least number of current connections. This is ideal for environments in which pool members have similar performance and capacity capabilities.'
  existing_monitor:
    title: 'Use an existing monitor'
  monitor_name:
    title: 'Specify the name of an existing BIG-IP monitor.'
    description: 'Monitors are used to determine the health of the application on each web server. If an application instance does not respond or responds incorrectly, the system will cease to send client requests to that web server. The system will continue to monitor the instance and will begin sending requests once the application responds correctly.'
  existing_tls_server:
    title: 'Use an existing TLS server profile'
  tls_server_profile_name:
    title: 'Specify the name of an existing BIG-IP clientssl profile.'
    description: 'TLS server profiles are of type "ltm clientssl" on BIG-IP.'
  tls_cert_name:
    title: 'Specify the name of an existing BIG-IP SSL certificate.'
  tls_key_name:
    title: 'Specify the name of an existing BIG-IP SSL key.'
  existing_tls_client:
    title: 'Use an existing TLS client profile'
  tls_client_profile_name:
    title: 'Specify the name of an existing BIG-IP serverssl profile.'
    description: 'TLS client profiles are of type "ltm serverssl" on BIG-IP.'
  existing_http_profile:
    title: 'Use an existing HTTP profile'
  http_profile_name:
    title: 'Specify the name of an existing BIG-IP HTTP profile.'
  existing_acceleration_profile:
    title: 'Use an existing Web Acceleration profile'
  acceleration_profile_name:
    title: 'Specify the name of an existing BIG-IP web acceleration profile.'
  existing_compression_profile:
    title: 'Use an existing HTTP Compression profile'
  compression_profile_name:
    title: 'Specify the name of an existing BIG-IP HTTP compression profile.'
  existing_multiplex_profile:
    title: 'Use an existing Multiplex (OneConnect) profile'
  multiplex_profile_name:
    title: 'Specify the name of an existing BIG-IP OneConnect profile.'
  app_pool_def:
    template: |
      {{^existing_pool}}
        "{{app_name:f5:non_empty_string}}_pool": {
          "class": "Pool",
          "members": [{
             "serverAddresses": {{pool_members:f5:ipv4_array}},
             "servicePort": {{pool_port:f5:http_port}},
             "shareNodes": true
          }],
          "loadBalancingMode": "{{load_balancing_mode:f5:load_balancing_mode}}",
          {{#existing_monitor}}
            "monitors": [ "{{monitor_name}}" ]
          {{/existing_monitor}}
          {{^existing_monitor}}
            "monitors": [ "https" ]
          {{/existing_monitor}}
        },
      {{/existing_pool}}
  app_tls_server_def:
    template: |
      {{^existing_tls_server}}
        "{{app_name:f5:non_empty_string}}_tls_server": {
          "class": "TLS_Server",
          "certificates": [{ "certificate": "{{app_name:f5:non_empty_string}}_certificate" }]
        },
        "{{app_name:f5:non_empty_string}}_certificate": {
          "class": "Certificate",
          "certificate": { "bigip": "{{tls_cert_name:f5:tls_cert_name}}" },
          "privateKey": { "bigip": "{{tls_key_name:f5:tls_key_name}}" }
        },
      {{/existing_tls_server}}
  app_tls_client_def:
    template: |
      {{^existing_tls_client}}
        "{{app_name:f5:non_empty_string}}_tls_client": {
          "class": "TLS_Client"
        },
      {{/existing_tls_client}}
  redirect80_def:
    template: |
      {{#redirect}}
          "redirect80": true,
      {{/redirect}}
  service_pool_def:
    template: |
      {{#existing_pool}}
        "pool": {
          "bigip": "{{pool_name}}"
        },
      {{/existing_pool}}
      {{^existing_pool}}
        "pool": "{{app_name:f5:non_empty_string}}_pool",
      {{/existing_pool}}
  service_tls_server_def:
    template: |
      {{#existing_tls_server}}
        "serverTLS": {
          "bigip": "{{tls_server_profile_name}}"
        },
      {{/existing_tls_server}}
      {{^existing_tls_server}}
        "serverTLS": "{{app_name:f5:non_empty_string}}_tls_server",
      {{/existing_tls_server}}
  service_tls_client_def:
    template: |
      {{#existing_tls_client}}
        "clientTLS": {
          "bigip": "{{tls_client_profile_name}}"
        },
      {{/existing_tls_client}}
      {{^existing_tls_client}}
        "clientTLS": "{{app_name:f5:non_empty_string}}_tls_client",
      {{/existing_tls_client}}
  service_http_def:
    template: |
      {{#existing_http_profile}}
        "profileHTTP": {
          "bigip": "{{http_profile_name}}"
        },
      {{/existing_http_profile}}
      {{^existing_http_profile}}
        "profileHTTP": "basic",
      {{/existing_http_profile}}
  service_acceleration_def:
    template: |
      {{#existing_acceleration_profile}}
        "profileHTTPAcceleration": {
          "bigip": "{{acceleration_profile_name}}"
        },
      {{/existing_acceleration_profile}}
      {{^existing_acceleration_profile}}
        "profileHTTPAcceleration": "basic",
      {{/existing_acceleration_profile}}
  service_compression_def:
    template: |
      {{#existing_compression_profile}}
        "profileHTTPCompression": {
          "bigip": "{{compression_profile_name}}"
        },
      {{/existing_compression_profile}}
      {{^existing_compression_profile}}
        "profileHTTPCompression": "basic",
      {{/existing_compression_profile}}
  service_multiplex_def:
    template: |
      {{#existing_multiplex_profile}}
          "profileMultiplex": {
            "bigip": "{{multiplex_profile_name}}"
          }
      {{/existing_multiplex_profile}}
      {{^existing_multiplex_profile}}
          "profileMultiplex": "basic"
      {{/existing_multiplex_profile}}
template: |
  {
    "class": "ADC",
    "schemaVersion": "3.0.0",
    "id": "urn:uuid:a858e55e-bbe6-42ce-a9b9-0f4ab33e3bf7",
    "{{tenant_name:f5:non_empty_string}}": {
      "class": "Tenant",
      "{{app_name:f5:non_empty_string}}": {
        "class": "Application",
        "template": "https",
        {{> app_pool_def}}
        {{> app_tls_server_def}}
        {{> app_tls_client_def}}
        "serviceMain": {
          "class": "Service_HTTPS",
          "virtualAddresses": ["{{virtual_address:f5:ipv4}}"],
          "virtualPort": {{virtual_port:f5:https_port}},
          "snat": "auto",
          {{> redirect80_def}}
          {{> service_pool_def}}
          {{> service_tls_server_def}}
          {{> service_tls_client_def}}
          {{> service_http_def}}
          {{> service_acceleration_def}}
          {{> service_compression_def}}
          {{> service_multiplex_def}}
        }
      }
    }
  }
