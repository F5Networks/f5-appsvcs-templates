bigipHideTemplate: true

virtual_base: &virtual_base
  contentType: application/json
  definitions: &virtual_base_def
    use_ipam:
      title: Use IPAM Provider
      description: Use an IP Address Management service to get an IP address
      type: boolean
      default: false
    virtual_address:
      title: Virtual Server IP Address
      description: This IP address, combined with the port you specify below, becomes
        the BIG-IP virtual server address and port, which clients use to access the application.
        The system uses this IP:Port for distributing requests to the web servers.
    virtual_address_ipam:
      title: Virtual Server IP Address from IPAM
      description: Select an IPAM Provider to get an IP address from.
        This IP address, combined with the port you specify below, becomes
        the BIG-IP virtual server address and port, which clients use to access the application.
        The system uses this IP:Port for distributing requests to the web servers.
      ipFromIpam: true
      default: ''
    virtual_port:
      title: Virtual Server Port
      default: 443

# default VS subtemplate
<<: *virtual_base
template: |
        {
          "{{tenant_name}}": {
            "{{app_name}}": {
              "{{app_name}}": {
                "virtualAddresses": [
                  {{#use_ipam}}
                    "{{virtual_address_ipam}}"
                  {{/use_ipam}}
                  {{^use_ipam}}
                    "{{virtual_address:f5:ipv4_ipv6}}"
                  {{/use_ipam}}
                ],
                "virtualPort": {{virtual_port:f5:port}}
              }
            }
          }
        }

# subtemplate with VS names unique to DNS template
dns:
  <<: *virtual_base
  definitions: 
    <<: *virtual_base_def
    virtual_port:
      title: Virtual Server Port
      default: 53
  template: |
      {
        "{{tenant_name}}": {
          "{{app_name}}": {
            "{{app_name}}_tcp": {
              {{#use_ipam}}
                "virtualAddresses": ["{{virtual_address_ipam}}"],
              {{/use_ipam}}
              {{^use_ipam}}
                "virtualAddresses": ["{{virtual_address:f5:ipv4_ipv6}}"],
              {{/use_ipam}}
              "virtualPort": {{virtual_port:f5:port}}
            },
            "{{app_name}}_udp": {
              {{#use_ipam}}
                "virtualAddresses": ["{{virtual_address_ipam}}"],
              {{/use_ipam}}
              {{^use_ipam}}
                "virtualAddresses": ["{{virtual_address:f5:ipv4_ipv6}}"],
              {{/use_ipam}}
              "virtualPort": {{virtual_port:f5:port}}
            }
          }
        }
      }