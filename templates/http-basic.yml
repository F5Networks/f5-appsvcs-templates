definitions:
  application_template_def:
    template: |
      {{#do_tls_server}}
        "template": "https",
      {{/do_tls_server}}
      {{^do_tls_server}}
        "template": "http",
      {{/do_tls_server}}
  application_pool_def:
    template: |
      {{#do_pool}}
        {{^pool_name}}
          "{{app}}_pool": {
            "class": "Pool",
            "monitors": [
              "http"
            ],
            "members": {{pool_members}}
          },
        {{/pool_name}}
      {{/do_pool}}
  service_main_class_def:
    template: |
      {{#do_tls_server}}
        "class": "Service_HTTPS",
      {{/do_tls_server}}
      {{^do_tls_server}}
        "class": "Service_HTTP",
      {{/do_tls_server}}
  service_main_pool_def:
    template: |
      {{#do_pool}}
        {{#pool_name}}
          "pool": {
            "bigip": "{{pool_name}}"
          },
        {{/pool_name}}
        {{^pool_name}}
          "pool": {
            "use": "{{app}}_pool"
          },
        {{/pool_name}}
      {{/do_pool}}
      {{^do_pool}}
        "pool": "none",
      {{/do_pool}}
  service_main_compression_def:
    template: |
      {{#do_compression}}
        {{#compression_profile_name}}
          "profileHTTPCompression": {
            "bigip": "{{compression_profile_name}}"
          },
        {{/compression_profile_name}}
        {{^compression_profile_name}}
          "profileHTTPCompression": "basic",
        {{/compression_profile_name}}
      {{/do_compression}}
template: |
  {
    "class": "ADC",
    "schemaVersion": "3.0.0",
    "id": "urn:uuid:a858e55e-bbe6-42ce-a9b9-0f4ab33e3bf7",
    "{{tenant}}": {
      "class": "Tenant",
      "{{app}}": {
        "class": "Application",
        {{> application_template_def}}
        {{> application_pool_def}}
        "serviceMain": {
          {{> service_main_class_def}}
          {{> service_main_pool_def}}
          {{> service_main_compression_def}}
          "virtualAddresses": ["{{virtual_addr}}"],
          "virtualPort": {{virtual_port::integer}}
        }
      }
    }
  }
